<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/style.css" />
  <title>MARKET HARDER - Dashboard</title>
</head>

<body>
  <!-- top navigation bar -->
  <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"> -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar"
            aria-controls="offcanvasExample">
            <span class="navbar-toggler-icon" data-bs-target="#sidebar"></span>
          </button> <span class="sm-nav-logo"></span>
          <a class="navbar-brand me-auto ms-lg-0 ms-3 text-uppercase fw-bold" href="#">MARKET HARDER</a>
    
        </div>
      </nav>
      <!-- top navigation bar -->
      <!-- offcanvas -->
      <div class="offcanvas offcanvas-start sidebar-nav" tabindex="-1" id="sidebar">
        <div class="offcanvas-body p-0">
          <nav class="navbar-dark">
            <ul class="navbar-nav">
              <li>
                <div class="nav-logo-container">
                  <div class="nav-logo"></div>
                </div>
              </li>
              <li>
                <a href="#" class="nav-link px-3 nav-link-active">
                  <span class="me-2"><i class="bi bi-speedometer"></i></span>
                  <span>Dashboard</span>
                </a>
              </li>
              <li>
                <a href="https://www.marketharder.com/integrations" class="nav-link px-3">
                    <span class="me-2"><i class="bi bi-gear-fill"></i></span>
                    <span>Integrations</span>
                  </a>
              </li>
              <li>
                <a href="https://www.marketharder.com/installscript" class="nav-link px-3 ">
                  <span class="me-2"><i class="bi bi-file-code-fill"></i></span>
                  <span>Script</span>
                </a>
              </li>
              <li>
                <a href="https://www.plans.marketharder.com/products" class="nav-link px-3">
                    <span class="me-2"><i class="bi bi-bag-fill"></i></span>
                    <span>Products</span>
                  </a>
                </li>
              <li>
                <a href="https://marketharderauthalpha1.auth.us-east-1.amazoncognito.com/logout?client_id=11dr4aadh9fk76c7ablauvugel&logout_uri=https://www.marketharder.com/" class="nav-link px-3 ">
                  <span class="me-2"><i class="bi bi-file-code-fill"></i></span>
                  <span>Log Out</span>
                </a>
              </li>
              <li class="last-item">
                <a href="https://www.marketharder.com/changebilling" class="nav-link px-3 nav-link-last">
                    <span class="me-2"><i class="bi bi-person-fill"></i></span>
                    <span>Account</span>
                  </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- offcanvas -->
      <main class="mt-5 pt-3">
        <h3 id="welcome-message" style="margin-left: 10px;margin-top: 3px; display: inline; align-items: center;">Welcome!</h3>
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12 mb-3">
              <div class="card">
                <div class="card-header" style="display: inline-flex; align-items: center; justify-content: space-between;">
                  <span style="display:inline-flex;margin-top: 4px; align-items: center;" >
                    <img width="40" height="40" src="https://img.icons8.com/external-kiranshastry-solid-kiranshastry/64/000000/external-filter-business-and-management-kiranshastry-solid-kiranshastry-4.png" />
                   <h3 style="margin-left: 10px;margin-top: 3px; display: inline; align-items: center;">Identified Leads</h3></span> 
                  <span style="float: right;"><label for="leads-list">
                    <img class="mb-25px" src="https://img.icons8.com/ios-filled/50/000000/import-csv.png"/>
                    <!-- <img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAACYUlEQVR4nO2asWtTURSHv6hxiAgpxUEoBUulrqUUcRR07VYsWOjWTShddHFzcRI7tR26uBQEQfAPUMdOXRxc1G6tDTi0ldKU1OG+wmt4yb0l591zTO4HF5KXk3N/fMnLu++9QGKwqQTUVIHlsoO00QA2gLPI8xZSwwWJPVYJ+4BKR0uAGQmaAkxI0BLQyj1+i6IELQGvgB+552rfBC0Bi8AoBiRoCgADErQFgLIECwJAUYIVAaAkwZIAUJBgTQBElmBRAESUYFUARJJgWQBEkGBdAPQgIaSoBhxdIowUO7gLI6Hcwok4ZwVYwgnpiGUBEtwA/nYruBIpiFmSAO0A2iQB2gG0SQK0A2hzTaDHR+LcOdoEpqWbSgg4wC1Dy+a4jKYSAm4DjwT6+KiX0TQthSMFMUsSoB1AG4kfwUPgt0CfPKPIZBPBd0XoXQlz/vLMGTpqvonSLiDQ4z6wJtAnz7Bwv46kdUCkIGZJArQDlMwLX4HEb8A34FNooh54CowE1B0Cu8A47lC4QI+Hao11QBFfPTnOcP8smwXuAPvZthPgYS8T/08CXubqHwPNbHsDuFvUVGIXOPG8LsVNuq9b3gNPuHgrbAl4kz3+DjwA/lx2Yu1/ioaMbdwxv4j1XN0X4Hq/CWgAY13yV4HPufqNfhJwCswAQ9m42pa9nm2/B+zl3ve8XwS0j6m27Ecd6lrAHBg6545MBbcr/BwUAVvAh4LtE4MiYBt4XfRCv58LeEkCtANokwRoB9AmCdAOoE3IOqBJwKUlRSZxp8EAz3BXg86pxo8Tn3n85wgd71sM/C7wD5vVNAamtXsdAAAAAElFTkSuQmCC"/>
                   <br> Upload List -->
                  </label>
                    <input type="file" id="leads-list" name="leads-list" style="display: none;">
                    <label for="leads-list"> 
                      <!-- <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAACYUlEQVR4nO2asWtTURSHv6hxiAgpxUEoBUulrqUUcRR07VYsWOjWTShddHFzcRI7tR26uBQEQfAPUMdOXRxc1G6tDTi0ldKU1OG+wmt4yb0l591zTO4HF5KXk3N/fMnLu++9QGKwqQTUVIHlsoO00QA2gLPI8xZSwwWJPVYJ+4BKR0uAGQmaAkxI0BLQyj1+i6IELQGvgB+552rfBC0Bi8AoBiRoCgADErQFgLIECwJAUYIVAaAkwZIAUJBgTQBElmBRAESUYFUARJJgWQBEkGBdAPQgIaSoBhxdIowUO7gLI6Hcwok4ZwVYwgnpiGUBEtwA/nYruBIpiFmSAO0A2iQB2gG0SQK0A2hzTaDHR+LcOdoEpqWbSgg4wC1Dy+a4jKYSAm4DjwT6+KiX0TQthSMFMUsSoB1AG4kfwUPgt0CfPKPIZBPBd0XoXQlz/vLMGTpqvonSLiDQ4z6wJtAnz7Bwv46kdUCkIGZJArQDlMwLX4HEb8A34FNooh54CowE1B0Cu8A47lC4QI+Hao11QBFfPTnOcP8smwXuAPvZthPgYS8T/08CXubqHwPNbHsDuFvUVGIXOPG8LsVNuq9b3gNPuHgrbAl4kz3+DjwA/lx2Yu1/ioaMbdwxv4j1XN0X4Hq/CWgAY13yV4HPufqNfhJwCswAQ9m42pa9nm2/B+zl3ve8XwS0j6m27Ecd6lrAHBg6545MBbcr/BwUAVvAh4LtE4MiYBt4XfRCv58LeEkCtANokwRoB9AmCdAOoE3IOqBJwKUlRSZxp8EAz3BXg86pxo8Tn3n85wgd71sM/C7wD5vVNAamtXsdAAAAAElFTkSuQmCC"/>
                       Download .CSV -->
                       <!-- <img width="32" height="32" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAFAElEQVR4nO3baYgcRRQH8F+MMRoC8UKD52oiMVEjHiiKYhQUJXgiIigYUIIEgqKoEPSTwRP9ICLeQhCJnzwi4hkP1BCIRgRvXY33rVGDGtesH1613TuZnenZ7dmZMfuHoaqrXle//terqlevehjHlo0JJWQm4bJ2K1KDH3A/Bsf4uXUxRSgy1r+7lOugtqNTBIwJCVu3KH8HbmmHIgkz8EzheiH+wiXaNBxaJeBn9LdDkYTJhfyg6P3F6botJGxVdYMV4jp8kvKLcac2DIduJuAzHC8nYaE2kNDNBMA6bSah2wmgzST0AgG0kYReIYA2kdBLBNAGEnqNAIKEeSoioRcJIJbISkjoVQKoiIReJoAKSOh1AhglCa1uhsYSS8TLlMXEQn4h/sSlKthAFeMBS0fbWBPMVm08YUqzB3abBWzAc6NsYwb2qUCX/zCWFlAFlmrBAv4Pk+CoME5ApxXoNMYJ6LQCncYWT0C7/IDdcSr6sB6P4+0amQNwCnbCl1ghtron4YQkczN+LNxzNg4XS9zV+Kc96g9Fq37AVfjDUI/s8hqZW7CpRuaBVHduoezkmvteTOW1ZBbRkh9QtQVcgRtS/kM8LXr45YLMAvlh68tYi/2wOpW9VpA9GE8Vruem9NXqVG6OshbQJ46xBvGEoac8RbySZB5p0NYXSeahQtmeBT0WNLi3Y57gxdgGG+VnevXQl9LVw9STW8HBhbK5hXxlFlAlASemdCW+aiC3LqXzDT8EV6V0FrZL+YyA7/DRCHXcDFURMFGu4Nomsnen9BixOuxaRyazgIk4MOXnFuoqOyStioBp8t78ronsMvnYPgVvCjKKWCsCGuQvflBKK50AqyKgONkMNJEdxAW4KeWn41mxvmfYiDUpP0dYwsx03YyAW0VMYIZYjhuiKgJ+L+SnlZAfEP7C6ULJbUUcr4hsHpgtJs7JwireaNL2T+Ibhn4lhkpVfsB6/ILtxcRVFiuE73A7DhMv+mmqy+aBOYU219h8ddkbRzR5Tj9eb0GvISjrBzybZL4WX5aVxaxC+0cWyndNZZtwTcrfWOf+8w31KIf71qguqlwGH07pdNGrZZGt9YPyJRK+xccivH1GKqvcA6zSFV6GK4Vbu1SM3aewg/jw6YMkdy/eF2v5TDEXEMHQb2raXCUms0MFQa9pjEXCBc/QyCMtjVY2Q7Pxuc1NMHNdJ4mJrLb+Y+xVp71FBZn3hnlmcQgcVlO3QZMhUPVm6F2xXi/EcdhR9Gr2ZdkEsRGahz3EjL0S9+C3Ou29JJ+8nqxY19Lo9rD4qCxgi48IjRPQaQU6jXECOq1Ap9Ftp8ONcI5wtGqxY4l7z7L5CsHQL9OHRbcsgxPwoMY+/3DLYL3fO9i+lyxgEBdhXxyVygaEs5Rte3+tuecFuSt8iIhQE0Gb+WIH2xTdYgEZdhb+fqbTkhL3HCuPWP+Bo1t5YLcRQOw5fhY6/YPTGsj2iR7PttbntfqwbiSAOEL7W+j1qzx4WsRUvCXX/5qRPKhbCYAL5bp9IoZHhq3wWKF+uTqfzrU6Ce4gJqFO4zd8j/tEz18qTH25OE8cwLXyofGKCMSOKJzeyb/NDfdbL06XiZ5+tFB3mzhFzg5f+7HLSF68mwkYFBGlzOSnirOErG5jSn/C/o1erlv/OlsWa/B8yu8hzht3S9d/i+GwsgN6dQyHijOKQXFYu0XiTFxfVvhfKk71DYGl8JcAAAAASUVORK5CYII="/> -->
                       <img class="mb-25px" src="https://img.icons8.com/ios-filled/50/000000/export-csv.png"/>
                      </label>
                    <input type="file" id="leads-list" name="leads-list" style="display: none;">
                    Range</span>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="lead-table" class="table table-striped data-table" style="width: 100%">
                      <thead>
                        <tr>
                          <th>Company</th>
                          <th>Address</th>
                          <th>Business Phone</th>
                          <th>Contact</th>
                          <!-- <th>Social Media</th> -->
                          <th>Webpage</th>
                          <!-- <th>IP Address</th> -->
                        </tr>
                      </thead>
                      <tbody>
                  
                      

                        <tfoot>
                            <tr>
                              <th>Company</th>
                              <th>Address</th>
                              <th>Business Phone</th>
                              <th>Contact</th>
                              <th>Webpage</th>
                            </tr>
                          </tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/jquery-3.5.1.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/jquery.dataTables.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/dataTables.bootstrap5.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/script.js"></script>
      <script src="js/jwt-decode.min.js"></script>
      <script>

function setCookie(name) {
    let date = new Date();
    // Set the cookie to expire one month from now.
    date.setTime(date.getTime() + 30*60*60*1000);
    let uID = Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 20);
    console.log('uuid: ', uID);
    let domainName = window.location.hostname;
    document.cookie = name + "=" + uID + "; expires=" + date.toUTCString() + "; domain=" + domainName + "; path=/";
    console.log('Cookie: ' + name + ' is set.');
    console.log(document.cookie);
}

function getCookie(name) {
    var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    if (match) {
        console.log('Cookie found!');
      console.log(match[2]);
    }
    else{
         console.log('Cookie: ' + name + ' was not found. Creating cookie.');
         setCookie(name);
    }
 }
    // getCookie("marketharderid");
          let url_string = window.location.href;
          let logged_in = false;
          if (url_string.includes("id_token") && url_string.includes("access_token")) { // Check for tokens
    let url = new URL(url_string.replace("#", "?"));
          let idToken = url.searchParams.get("id_token");
          let accessToken = url.searchParams.get("access_token");
          if (!idToken || !accessToken) {
              console.log('Not logged in 1');
              logged_in = false;
          } else {
              console.log('logged in!');
              console.log('idtoken: ' + idToken);
              console.log('accesstoken: ' + accessToken);
              localStorage.setItem('idtoken', String(idToken));
              localStorage.setItem('accesstoken', String(accessToken));
              logged_in = true;
          }
        } else {
            const idtoken = localStorage.getItem('idtoken');
    const accesstoken = localStorage.getItem('accesstoken');
    if (!idtoken|| !accesstoken) {
          console.log("Not logged in 2");
          logged_in = false;
      }
      logged_in = true;
        }
        if (logged_in) {
            const accesstoken = localStorage.getItem('accesstoken');
            const idtoken = localStorage.getItem('idtoken');
            console.log('fetching user info.');
        let url = "https://8mtnj67pse.execute-api.us-east-1.amazonaws.com/test/getuserinfo?idtoken=" + idtoken;
        fetch(url, {
        method: 'GET',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/json',
            'Accept': '*/*',
            'Authorization' : 'Bearer '+ accesstoken,
        },
        })
        .then(response => response.json())
    .then(data => {
        console.log('returned data');
        console.log(data);
        document.getElementById("welcome-message").innerHTML = "Welcome, " + String(data.body.first_name) + "!";
        return data;
    })
    .catch(error => {
        console.log('error');
        console.log(error);
        return error;
    });

    console.log('fetching leads');
    url = "https://8mtnj67pse.execute-api.us-east-1.amazonaws.com/test/getleads?idtoken=" + idtoken;
        fetch(url, {
        method: 'GET',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/json',
            'Accept': '*/*',
            'Authorization' : 'Bearer '+ accesstoken,
        },
        })
        .then(response => response.json())
        .then(data => {
        console.log('returned lead data');
        console.log(data);
        let leadTable = document.getElementById("lead-table");
        let current_row = 0;
        for (let i = 0; i < data.body.length; i++) {
            if (data.body[i].companyName === null || data.body[i].companyName === 'undefined') {
                continue;
            }
            let row = leadTable.insertRow(current_row+1);
            let company = row.insertCell(0);
            let address = row.insertCell(1);
            let businessPhone = row.insertCell(2);
            let contact = row.insertCell(3);
            // let socialMedia = row.insertCell(4);
            let webpage = row.insertCell(4);
            // let ipAddress = row.insertCell(6);

            company.innerHTML = ("companyName" in data.body[i] && data.body[i].companyName !== 'undefined') ? data.body[i].companyName : "";
            address.innerHTML = ("Address" in data.body[i] && data.body[i].Address !== 'undefined') ? data.body[i].Address : "";
            businessPhone.innerHTML = ("phone" in data.body[i] && data.body[i].phone !== 'undefined') ? data.body[i].phone : "";
            contact.innerHTML = "";
            // socialMedia.innerHTML = "";
            webpage.innerHTML = ("website" in data.body[i] && data.body[i].website !== 'undefined') ? data.body[i].website : "";
            // ipAddress.innerHTML = data.body[i].ipAddress !== null ? data.body[i].ipAddress : "";
            current_row += 1;
        }
        return data;
    })
    .catch(error => {
        console.log('error');
        console.log(error);
        return error;
    });
}
      </script>
</body>

</html>