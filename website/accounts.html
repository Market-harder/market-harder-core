<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/css/font-awesome.min.css">
  <!-- <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/js/auth.js"></script> -->
  
  <title>MARKET HARDER - Accounts</title>
</head>

<body>
  <!-- top navigation bar -->
  <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"> -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar"
        aria-controls="offcanvasExample">
        <span class="navbar-toggler-icon" data-bs-target="#sidebar"></span>
      </button> <span class="sm-nav-logo"></span>
      <a class="navbar-brand me-auto ms-lg-0 ms-3 text-uppercase fw-bold" href="index.html">MARKET HARDER</a>
     
    </div>
  </nav>
  <!-- top navigation bar -->
  <!-- offcanvas -->
  <div class="offcanvas offcanvas-start sidebar-nav" tabindex="-1" id="sidebar">
    <div class="offcanvas-body p-0">
      <nav class="navbar-dark">
        <ul class="navbar-nav">
          <li>
            <div class="nav-logo-container">
              <div class="nav-logo"></div>
            </div>
          </li>
          <li>
            <a href="https://www.marketharder.com/portal" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-speedometer"></i></span>
                <span>Dashboard</span>
              </a>
          </li>
          <li>
            <a href="https://www.marketharder.com/integrations" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-gear-fill"></i></span>
                <span>Integrations</span>
              </a>
          </li>
          <li>
            <a href="https://www.marketharder.com/installscript" class="nav-link px-3 ">
                <span class="me-2"><i class="bi bi-file-code-fill"></i></span>
                <span>Script</span>
              </a>
          </li>
          <li>
            <a href="https://www.plans.marketharder.com/products" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-bag-fill"></i></span>
                <span>Products</span>
              </a>
            </li>
          <li>
                <a href="https://marketharderauthalpha1.auth.us-east-1.amazoncognito.com/logout?client_id=11dr4aadh9fk76c7ablauvugel&logout_uri=https://www.marketharder.com/" class="nav-link px-3 ">
                  <span class="me-2"><i class="bi bi-file-code-fill"></i></span>
                  <span>Log Out</span>
                </a>
              </li>
          <li class="last-item">
            <a href="#" class="nav-link px-3 nav-link-active nav-link-last">
              <span class="me-2"><i class="bi bi-person-fill"></i></span>
              <span>Account</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- offcanvas -->
  <main class="mt-5 pt-3">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12 mb-3">
          <div class="card" style="position:static ;">
            <div class="card-header" style="display: flex;justify-content: left; align-items: center;">
              <!-- <span> -->

                <img width="40" height="40" src="https://img.icons8.com/ios-glyphs/90/000000/about-us-male.png"/>
              <h3 style="margin-left: 10px;margin-top: 3px;">General Information</h3>
              <!-- </span>  -->

            </div>
            <div class="card-body"
              style="display: flex;justify-content: center; align-items: center; ">

              <form autocomplete="off" id="geninfo">
                <div id="focus"></div>
                <input type="text" half placeholder="First name" autocomplete="no" id="fname">
                <input type="text" half placeholder="Last name" autocomplete="no" id="lname">
                <input type="text" placeholder="E-mail" autocomplete="no" id="email">
                <input type="text" half placeholder="Phone" autocomplete="no" id="phone">
                <input type="text" half placeholder="Business name" autocomplete="no" id="bname">
                <input type="text" placeholder="Address" autocomplete="no" id="address">
                <input class="theme-btn" type="submit" value="Save">
              </form>

            </div>
          </div>
        </div>
      </div>



    </div>

  </main>
  <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/jquery-3.5.1.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/script.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/dropdown.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/Market-harder/market-harder-core@master/website/js/form-script.js"></script>
  <script>
    console.log("starting script");
    const idtoken = localStorage.getItem('idtoken');
    const accesstoken = localStorage.getItem('accesstoken');
     const infoForm = document.getElementById("geninfo");

     if (idtoken && accesstoken) {
         console.log('Logged in! Fetching user info.');
         let url1 = "https://8mtnj67pse.execute-api.us-east-1.amazonaws.com/test/getuserinfo?idtoken=" + idtoken;
        fetch(url1, {
        method: 'GET',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/json',
            'Accept': '*/*',
            'Authorization' : 'Bearer '+ accesstoken,
        },
        })
        .then(response => response.json())
    .then(data => {
        console.log('returned data');
        console.log(data);
        console.log('first name: ' + data.body.first_name);
        if (data.body.first_name != undefined) {
            document.getElementById("fname").placeholder = data.body.first_name;
        }
        if (data.body.last_name != undefined) {
            document.getElementById("lname").placeholder = data.body.last_name;
        }
        if (data.body.email != undefined) {
            document.getElementById("email").placeholder = data.body.email;
        }
        if (data.body.phone != undefined) {
            document.getElementById("phone").placeholder = data.body.phone;
        }
        if (data.body.companyName != undefined) {
            document.getElementById("bname").placeholder = data.body.companyName;
        }
        if (data.body.address != undefined) {
            document.getElementById("address").placeholder = data.body.address;
        }
        return data;
    })
    .catch(error => {
        console.log('error');
        console.log(error);
        return error;
    });
     }


    infoForm.addEventListener("submit", (e) => {
      e.preventDefault();
      console.log("Form is submitted!");

      if (document.getElementById("email").value == "" ||  document.getElementById("fname").value == "" || document.getElementById("lname").value == "" || document.getElementById("phone").value == "" || document.getElementById("address").value == "" || document.getElementById("bname").value == "") {
          alert("You must fill all input boxes.");
      } else if (!idtoken|| !accesstoken) {
          alert("You are not logged in");
      } else {
        console.log('idtoken: ' + idtoken);
        console.log('accesstoken: ' + accesstoken);
      let url = "https://8mtnj67pse.execute-api.us-east-1.amazonaws.com/test/updateuserinfo";
      fetch(url, {
        method: 'POST',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/json',
            'Accept': '*/*',
            'Authorization' : 'Bearer '+ accesstoken,
        },
        body: JSON.stringify({"body" : { idtoken : String(idtoken), email : document.getElementById("email").value, fname : document.getElementById("fname").value, lname : document.getElementById("lname").value, phone : document.getElementById("phone").value, address : document.getElementById("address").value, bname : document.getElementById("bname").value}})
    })
    .then(data => {
        console.log('returned data');
        console.log(data);
        return data;
    })
    .catch(error => {
        console.log('error 2');
        console.log(error);
        return error;
    });
}
    });
  </script>
</body>

</html>